<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Gaming Platform</title>
  <meta name="description" content="Gaming Platform for games using GameApi">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular-route.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular-animate.js"></script>
  <script src="ui-bootstrap-tpls-0.11.2.min.js"></script>
  <script src="views.js"></script>
  <script src="platformMessageService.js"></script>
  <script src="platformScaleService.js"></script>
  <script src="interComService.js"></script>
  <script src="stateService.js"></script>
  <script src="pushService.js"></script>
  <script src="http://yoav-zibin.github.io/emulator/serverApiService.js"></script>
  <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="platform.css" />
    <script type="text/javascript">
    angular.element(document.getElementsByTagName('head')).append(angular.element('<base href="' + window.location.pathname + '" />'));
  </script>
</head>
<body class="platformBackground" style="height:100%; width:100%; overflow: hidden;"
    ng-cloak>

    <span ng-controller="pushCtrl">
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="PushNotification.js"></script>
    <script>
    function successHandler (result) {
      alert('result = ' + result);
    }
    function errorHandler (error) {
      alert('error = ' + error);
    }
    function registerForPushNotification() {
      alert('registerForPushNotification for cordova.platformId:' + cordova.platformId);
      var pushNotification = window.plugins.pushNotification;
      if ( cordova.platformId == 'android' || cordova.platformId == 'Android' || cordova.platformId == "amazon-fireos" ){
        pushNotification.register(
          successHandler,
          errorHandler,
          {
              "senderID":"24803504516",
              "ecb":"onNotification"
          });
      } else {
        pushNotification.register(
          tokenHandler,
          errorHandler,
          {
              "badge":"true",
              "sound":"true",
              "alert":"true",
              "ecb":"onNotificationAPN"
          });
      }
    }
    // iOS
    function onNotificationAPN(event) {
      alert('RECEIVED:' + JSON.stringify(event));
      if ( event.alert )
      {
          navigator.notification.alert(event.alert);
      }
      if ( event.sound )
      {
          var snd = new Media(event.sound);
          snd.play();
      }
      if ( event.badge )
      {
          window.plugins.pushNotification.setApplicationIconBadgeNumber(successHandler, errorHandler, event.badge);
      }
    }
    function tokenHandler(result) {
      // Your iOS push server needs to know the token before it can push to this device
      // here is where you might want to send it the token for later use.
      alert('device token = ' + result);
      document.getElementById("regIdTextarea").value = result;
    }
    // Android and Amazon Fire OS
    function onNotification(e) {
      alert('RECEIVED:' + JSON.stringify(e));
      switch( e.event )
      {
        case 'registered':
          if ( e.regid.length > 0 )
          {
            // Your GCM push server needs to know the regID before it can push to this device
            alert('REGID:' + e.regid);
            document.getElementById("regIdTextarea").value = e.regid;
            window.regid = e.regid;
            $rootScope.regid = e.regid;
            registerDevice();
          }
        break;
          case 'message':
            alert('A MESSAGE NOTIFICATION IS RECEIVED!!!');
            $apply(pushSomeEvent());
          // if this flag is set, this notification happened while we were in the foreground.
          // you might want to play a sound to get the user's attention, throw up a dialog, etc.
          // e.foreground , e.coldstart
          // e.soundname || e.payload.sound
          // e.payload.message
          // e.payload.msgcnt
          // e.payload.timeStamp
        break;
        case 'error':
          // e.msg
        break;
      }
    }
    document.addEventListener("deviceready", registerForPushNotification, false);
    </script>
    <textarea id="regIdTextarea">regId</textarea>
    <button ng-click="pushSomeEvent()">Refresh</button>
    <button ng-click="registerDevice()">Register</button>
    </span>

  	<div ng-controller="routeCtrl" id="gameContent" class="slowlyAppear">
  		<div>
      		<div ng-view ng-class="animationStyle" style="position:absolute;height:100%; width:100%;"></div>
      	</div>
    </div>
</body>
</html>
